package main

import (
	"github.com/Maksym-Perehinets/retrival_mcp/database_service"
	"github.com/Maksym-Perehinets/retrival_mcp/messages"
	"github.com/Maksym-Perehinets/shared/database"
	"github.com/Maksym-Perehinets/shared/discord"
	"log"
)

func main() {
	dbService := database.New()
	discordBot := discord.StartBot()
	messageService := messages.NewMessageService(discordBot.Session())

	// Initialize the database connection
	defer dbService.Close()

	// Perform health check
	health := dbService.Health()
	// Print health status
	for key, value := range health {
		println(key, ":", value)
	}

	dbSearch := database_service.NewMessageService(dbService.DB())

	messageEmbeddings, err := dbSearch.Search([]float32{0.016194865, -0.010814846, 0.0038431978, 0.015582877, 0.019729786, 0.028882215, -0.01337241, 0.094702974, 0.03491076, 0.043003626, -0.033668514, -0.06762932, 0.023255572, -0.040336452, -0.01947403, 0.022945011, -0.0021408189, 0.06532751, -0.027548626, -0.016222268, 0.018240917, -0.037888497, 0.058349013, -0.03785196, 0.03089173, 0.00019938158, 0.011235017, 0.038984597, -0.018076504, 0.02621504, -0.013116654, 0.005686015, 0.014404571, 0.049324464, 0.024315134, 0.015098766, -0.039130744, 0.0139113255, -0.023145963, 0.039423034, -0.01614006, 0.033650246, 0.0081385365, -0.015592012, -0.054622278, 0.026726553, 0.026580406, 0.024132451, 0.037450057, 0.047059193, 0.009156995, 0.0026420557, -0.058677845, -0.024059378, 0.033431027, 0.019309614, 0.04797261, 0.04903217, 0.047059193, -0.07201372, -0.03346756, 0.033083927, 0.049141783, 0.035148248, -0.017921222, -0.01614006, -0.01806737, 0.056631792, -0.0150165595, -0.023511328, -0.013737777, 0.009828356, 0.0053252154, 0.025849674, 0.05338003, 0.01750105, -0.01446851, -0.03602513, 0.08637262, -0.039824937, -0.018222649, -0.044720847, -0.018725028, -0.012970507, 0.019346152, 0.01673378, 0.010193722, -0.040701818, -0.001964986, -0.0024205525, 0.055389546, 0.012020554, 0.034655005, 0.069565766, 0.06773893, -0.013573362, -0.055170327, -0.018030832, 0.028553385, 0.009846625, -0.037705813, 0.022177741, 0.005992009, -0.0072707916, 0.0069784983, 0.032115705, 0.008864703, 0.0011440535, -0.024296867, 0.014459375, 0.0014683162, -0.04501314, 0.011572981, 0.034216564, -0.046693828, 0.043990117, -0.03602513, -0.017099148, -0.027804384, 0.034782883, 0.070844546, 0.02806014, -0.05341657, 0.0058961003, -0.03392427, -0.007887348, -0.046803437, -0.004055567, 0.014550717, -0.01778421, -0.044538166, -0.030087924, -0.0346002, 0.014779071, -0.050310954, 0.0037404385, -0.02011342, 0.005485063, 0.0030804954, -0.018871175, 0.002765367, 0.037249103, -0.0127238855, 0.015317987, -0.06620439, 0.022981547, -0.035952054, -0.0014648909, -0.02250657, 0.029393727, 0.028443774, -0.026507333, -0.012705617, 0.00563121, 0.047351487, -0.024443012, 0.027493821, -0.004571647, 0.043770894, 0.053051203, -0.012705617, 0.009810088, -0.025210282, -0.04614578, 0.067044735, -0.06821391, -0.028334165, -0.0020369177, -0.013518557, 0.02893702, -0.014751669, -0.04121333, 0.07318289, 0.021940252, -0.04852066, -0.075411625, -0.032773368, 0.0036399628, -0.007247956, -0.02968602, -0.020898959, 0.0014751669, -0.010851382, 0.007928451, 0.04830144, 0.0004378688, 0.004299906, -0.0043569943, -0.032992586, -0.022652717, 0.019674981, -0.011463371, -0.0014626074, -0.011079736, -0.030033119, 0.030361949, -0.06320839, 0.0073347306, 0.058093257, 0.014669461, -0.029338922, 0.08776101, -0.036262617, 0.020844154, 0.015573743, -0.015336255, 0.045524653, 0.036810666, 0.030288875, 0.0043410095, 0.024643963, -0.015509804, 0.013664704, -0.013034446, 0.033193536, 0.06488907, -0.02915624, 0.005069459, -0.0060833506, -0.051991638, 0.0217393, -0.04504968, 0.031786878, -0.0155463405, 0.013491155, -0.049872514, -0.0016464323, -0.014148814, 0.020533592, 0.029010093, 0.028571652, -0.009828356, 0.0047543305, 0.019547103, -0.041688308, -0.0073895357, -0.008074597, 0.018387064, -0.027548626, 0.017985161, 0.0028201719, 0.0057179844, -0.0049233125, -0.05612028, -0.04742456, -0.08703028, 0.015363657, 0.06426795, -0.015902573, -0.035878982, -0.093387656, 0.016879927, 0.029284118, -0.032408, -0.036701057, 0.025100673, -0.019839397, -0.035203055, -0.05995663, -0.03675586, 0.0076224566, -0.045743875, -0.016615037, -0.0016692678, -0.044866994, -0.0578375, -0.012943105, 0.050639782, 0.011737396, 0.023803622, 0.06101619, -0.011198481, -0.03708469, 0.008549574, 0.018396199, -0.01947403, -0.057800964, -0.034125224, 0.090318576, 0.003827213, -0.049105246, -0.022853669, -0.00114177, -0.045634262, -0.025959283, -0.032261852, -0.08498423, -0.006544626, 0.005713417, 0.048118755, -0.028900482, 0.010897053, -0.03989801, -5.5696968e-05, 0.04468431, 0.02272579, -0.033047393, -0.0024159853, 0.026525602, 0.040153768, -0.034782883, 0.031220559, 0.03023407, -0.0017731688, 0.019638443, -0.03262722, -0.025155477, 0.0434786, -0.02500933, -0.00035080884, 0.041396014, -0.022689253, -0.05951819, -0.05133398, -0.033102196, 0.039971083, -0.041359477, -0.031695537, 0.07226948, 0.046474606, 0.018743297, 0.033778124, 0.0050557577, 0.020095153, -0.02968602, -0.008590678, 0.007184017, 0.06233151, -0.055316474, 0.014715132, -0.0017160804, 0.0008186491, -0.008887538, -0.0041377745, 0.037450057, -0.03231666, 0.007996957, -0.034417514, 0.016204, 1.602046e-05, 0.0071474803, 0.0072022853, -0.034435783, -0.058166333, -0.03728564, 0.011454237, 0.037029885, 0.017702002, 0.011207614, -0.075046256, 0.00061541406, 0.032663755, 0.009737015, -0.026945772, -0.013564228, -0.071794495, -0.06361029, 0.042601723, -0.00092312106, 0.026690016, 0.027585164, -0.02720153, 0.0064076134, 0.024972795, -0.029211044, 0.043076698, -0.016130926, 0.022141203, -0.050274417, 0.016258804, -0.019967275, 0.030836925, 0.019620176, -0.02720153, -0.020149957, -0.05579145, -0.019492298, 0.0049963854, 0.03454539, -0.011298956, -0.014687729, -0.011563847, -0.032444537, -0.041724842, 0.06320839, -0.0404826, 0.03781542, -0.02338345, -0.03133017, -0.05502418, -0.0058595636, -0.00029800198, 0.021465275, -0.017117416, -0.0368472, -0.024443012, 0.033705052, 0.0032974319, 0.031805146, 0.018341394, -0.038801912, 0.0191452, -0.002397717, -0.049141783, -0.016505428, -0.036902007, 0.011883542, -0.03653664, 0.014340632, 0.026068892, -0.019985542, -0.04329592, -0.057472136, 0.049214855, -0.015573743, 0.059298966, 0.04402665, -0.016825123, -0.035915516, -0.011061468, 0.011399432, 0.010065844, 0.015966512, 0.021885447, 0.03480115, 0.016240537, 0.023438254, -0.041176792, -0.07153874, 0.043003626, -0.045415044, 0.019674981, -0.041834455, 0.064816, -0.015674219, -0.013180593, 0.04837451, 0.030763851, 0.008120269, 0.002277831, -0.022597913, -0.04852066, 0.0058458624, 0.013390679, -0.064121805, 0.00042787832, 0.013619033, -0.00055518566, 0.025100673, -0.029667752, -0.028681263, 0.06404873, -0.019291347, 0.020716276, 0.007576786, -0.010312467, -0.0019432926, -0.0083942935, 0.043222845, -0.0064852536, -0.011719127, 0.0001517127, 0.037705813, 0.039276887, 0.0077274996, 0.0040692682, -0.0035440542, -0.022488302, -0.017619794, 0.01978459, 0.07044264, 0.0010629878, 0.07672694, -0.014678596, 0.025502576, 0.043442067, -0.006846053, 0.01864282, -0.0091158915, -0.00438668, -0.03781542, -0.026068892, 0.056924086, -0.011947482, -0.008115701, -0.004968983, -0.031512853, 0.071209915, 0.007759469, 0.029448532, 0.054220375, 0.01539106, -0.033997346, -0.0111528095, 0.019400956, 0.048666805, -0.0058732647, 0.0051425323, 0.0011771648, 0.012486397, 0.018396199, 0.029923508, 0.035842445, 0.00090428186, -0.0024936257, 0.049178317, -0.022908473, 0.011646054, -0.036609713, 0.043624748, 0.0687985, -0.0036353958, 0.010239393, 0.0005814464, 0.020533592, 0.018195247, -0.013682972, -0.013774313, -0.027804384, 0.020606665, 0.014294961, -0.029338922, -0.027987067, 0.031494584, 0.0071063763, -0.015071364, 0.052905057, -0.021264324, 0.056814477, -0.0035189353, -0.0022903907, -0.0073758345, -0.033705052, -0.029338922, -0.06532751, -0.030489827, 0.024315134, -0.01675205, -0.021538349, 0.013819984, -0.017985161, 0.0005660325, -0.020369178, -0.012139299, 0.0020243581, 0.022031594, -0.009700478, -0.028736068, -0.002685443, -0.025612185, 0.018341394, 0.041432552, -0.0349473, 0.00082778325, -0.010659565, 0.014788205, 0.07135606, 0.016934732, -0.057143304, 0.001945576, 0.007887348, -0.04621885, 0.0025438636, -0.03220705, -0.024917988, -0.0057545207, -0.025959283, -0.014486778, -0.003813512, 0.022031594, 0.023584401, -0.0066542355, 0.052247398, 0.018250052, -0.020898959, 0.019017322, -0.0010492867, -0.009636539, -0.040409524, -0.00946299, 0.04994559, -0.0009790678, 0.034088686, -0.008851001, 0.03326661, -0.0027630834, 0.043990117, -0.011737396, 0.016532829, 0.053672325, -0.036299154, 0.036445297, -0.03469154, -0.03207917, 0.00071474805, -0.032115705, 0.00015071365, 0.004464321, 0.048557196, 0.02250657, -0.016194865, -0.0028224555, 0.013655569, -0.043222845, -0.0010664132, 0.066167854, 0.020789348, 0.0057682223, -0.036956813, -0.012011421, -0.011691725, 0.015802097, 0.01587517, -0.023547865, -0.019273078, 0.009061087, 0.014806474, 0.04548812, 0.0056083743, 0.033650246, -0.019875932, 0.064669855, -0.016103525, -0.047241878, 0.000325119, 0.00011303523, 0.01864282, -0.01747365, -0.037486594, -0.013335873, -0.005480496, -0.029941777, -0.001668126, 0.0049507148, -0.020624934, -0.037267372, -0.01833226, 0.014057472, -0.05177242, 0.030197533, 0.049287926, 0.009937966, -0.0075676516, 0.020734543, -0.029411996, -0.009892295, -0.058202866, -0.031348437, 0.026635211, 0.036810666, 0.02000381, 0.051443588, 0.013491155, 0.019985542, -0.040336452, -0.0025507142, 0.04044606, 0.025648722, 0.011116273, -0.021830643, 0.00048039973, 0.0139113255, -0.018834637, -0.07022342, 0.033595443, 0.013756045, 0.010111515, 0.023767084, 0.0067729796, 0.0913416, 0.036244348, 0.03346756, 0.029905241, 0.003420743, 0.010321601, 0.004434635, 0.053087737, 0.037705813, 0.00603768, 0.013756045, -0.056997158, -0.0006359659, -0.02860819, -0.0045647966, 0.007823409, -0.0018188396, -0.05023788, -0.007690963, -0.034417514, -0.017966893, -0.017848149, 0.019547103, 0.024717037, 0.0056677465, 0.0006468127, -0.017254429, 0.010760041, -0.030635973, -0.012084493, 0.0134454835, 0.005480496, -0.0137012405, -0.024881452, -0.06529098, 0.0689081, -0.048447587, -0.007526548, 0.034180027, -0.024808379, 0.0103672715, -0.0036353958, -0.041907527, 0.017172221, 0.012696482, -0.005517033, 0.018725028, -0.012294579, 0.030453289, -0.01392046, -0.051808957, -0.039605718, -0.013007044, -0.065400586, 0.03328488, 0.011289822, 0.001613321, 0.031512853, -0.041432552, 0.0027836354, 0.0038249295, 0.03511171, -0.044793922, 0.012915703, 0.0136373015, 0.0036902006, -0.08198822, -0.018670224, 0.04402665, -0.028206287, 0.045378506, 0.052722372, -0.0012570887, -0.0017252145, 0.030800387, 0.055608768, 0.0024867752, -0.0136373015, 0.0068369186, -0.040811427, 0.005772789, -0.020990299, -0.041505624, -0.008567843, 0.0074991453, 0.01071437, 0.01635928, 0.03836347, -0.012550336, 0.03732218, 0.015381926, -0.011536445, -0.032152243, 0.020497056, 0.025685258, 0.049543686, -0.02175757, -0.004062418, -0.0020072316, 0.0023349198, 0.01800343, 0.0250276, 0.047863, -0.066131316, -0.010047576, 0.004955282, 0.006234064, 0.03034368, -0.005603807, 0.0504571, -0.009663941, -0.036171272, -0.03414349, 0.016194865, 0.027018845, -0.026032357, -0.0024388207, 0.052612763, 0.025941014, 0.029028362, 0.024223793, -0.045890022, -0.023419987, 0.06982152, 0.0063436744, 0.07183103, -0.026361186, -0.012486397, 0.0024114184, -0.003514368, -0.0061472896, -0.035805907, -0.013500289, 0.0060696495, 0.0039939117, -0.031914756, 0.020040348, -0.004051, 0.035495345, -0.03717603, 0.055206865, 0.059116285, 0.002959468, 0.026598675, 0.045634262, 0.039824937, -0.021812374, -0.008554141, 0.024717037, -0.05721638, 0.03739525, 0.04439202, -0.032554146, -0.028261092, -0.00105785, -0.02806014, -0.058020186, 0.007252523, 0.038436547, 0.001072122, 0.007782304, 0.022323888, -0.012605141, -0.024497818, -0.008289251, -0.0191452, 0.01457812, 0.017756807, -0.025703527, -0.038326938, -0.0004318745, 0.025740063, -0.03545881, 0.018871175, -0.033157002, -0.035203055, 0.019565372, -0.020369178, -0.06404873, -0.047461096, -0.024552623, -0.011572981, 0.035842445, 0.004521409, -0.0141670825, -0.031512853, 0.057691354, -0.0020140824, 0.04241904, 0.04793607, 0.017080879, 0.020478787, -0.027658237, 0.052722372, 0.0032951483, -0.029886972, -0.0023326362, -0.0058458624, -0.018725028, -0.023182498, -0.022250814, -0.015783828, -0.010129783, -0.010476882, 0.034344442, -0.010705235, -0.025392964, 0.020478787, -0.007480877, 0.019053858, 0.02970429, -0.04336899, 0.0020688872, 0.028516848, 0.031786878, 0.024315134, 0.009047385, 0.015199242, 0.014779071, 0.066131316, -0.010595626, 0.012294579, -0.023145963, -0.00016027597, 0.0039756433, -0.01506223, 0.014313229, -0.0076087555, -0.023803622, -0.059079748, -0.0014774504, -0.017272696, -0.02141047, -0.014057472, -0.0038112283, 0.014989157, -0.02142874, -0.025447771, -0.0006770696, -0.044976603, -0.019528834, 0.006900858, 0.012203238, 0.060833506, -0.011024931, 0.009147861, -0.0050466233, -0.030160997, -0.0076863957, 0.028571652, -0.036043394, 0.048264902, 0.015400194, 0.018980784, 0.016541963, -0.013153191, -0.052028175, -0.024991062, 0.009152428, -0.032481074, 0.03902113, 0.022543108, 0.005320648, 0.018889444, 0.020149957, -0.008919507, -0.03348583, -0.04176138, -0.01418535, -0.020131689, -0.024589159, 0.009663941, 0.011225883, -0.024808379, 0.0019136065, 0.019437492, 0.03578764, -0.00013993819, 0.06602171, -0.015555475, 0.017765941, 0.020917227, 0.02164796, 0.033230074, 0.033010855, -0.00032426268, 0.014157948, -0.046511143, -0.033010855, 0.049251392, -0.013792582, -0.021447008, -0.05506072, -0.026927505, 0.015254048, -0.026014088, -0.004203997, 0.021940252, -0.0009111325, -0.039532647, -0.009033685, -0.021775838, 0.0067501445, 0.02228735, 0.004267936, -0.004350144, 0.035623226, -0.03512998, -0.012906568, -0.03001485, -0.022871938, 0.017099148, 0.073767476, -0.030398484, -0.0028407238, 0.01027593, 0.038253862, 0.031257097, -0.01728183, 0.006713608, -0.0024707904, -0.0008534731, -0.042674795, 0.028553385, -0.028206287, -0.0032380598, -0.024936257, 0.044866994, -0.00039790684, 0.007782304, -0.01185614, -0.0239315, -0.013582496, 0.005124264, -0.0011098004, -0.019967275, 0.0393865, 0.0006456709, 0.02011342, 0.029046629, 0.03708469, 0.0035120845, -0.0079695545, -0.0023543297, -0.0180491, -0.012239775, 0.04004416, 0.04395358, 0.024753574, -0.01196575, 0.06971191, -0.034307905, -0.0018941965, -0.0051699346, 0.0027996202}, 10, 7)
	if err != nil {
		println("Error searching messages:", err.Error())
	}

	for _, message := range messageEmbeddings {
		println("Message ID:", message.ID)
	}

	m, err := messageService.GetMessages(messageEmbeddings)
	if err != nil {
		println("Error getting messages:", err.Error())
	}
	for _, message := range m {
		println("Message ID:", message.ID)
		log.Printf("Message Content: %s", message.Content)

	}
}
